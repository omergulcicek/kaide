---
description: "USE WHEN: HTTP/API katmanı veya endpoint yazıyorsan."
globs: "src/lib/api.ts,src/features/**/api/*.{ts,tsx}"
alwaysApply: false
---

# API Layer

## Constraints

- **Location:** Tüm HTTP çağrılarını `features/[feature]/api` altına koy.
- **Validation:** Input/Output için Zod kullan.
- **Return Type:** Raw response dönme; typed data dön.
- **Error Handling:** API hatalarını `AppError` formatına normalize et.
- **Server Actions:** Sadece API katmanını çağır. DB erişimini server runtime'da tut.
- **Config:** `baseURL`'i env'den al. Tek `axios` instance kullan (`src/lib/api.ts`).
- **Interceptors:** Auth, locale, tenant işlemlerini interceptor'da yönet.
- **Naming:** `verb-entity.api.ts` (örn: `get-users.api.ts`). Fonksiyon: `getUsers`.

## Bans

- UI bileşeni içinde `fetch`/`axios`.
- Feature içinde `axios.create`.
- Cross-feature API import.
- Untyped response kullanımı.
- Query içinde endpoint string.
- Raw error fırlatmak.

## Always Do

```ts
export const getUsers = async (): Promise<User[]> => {
  const { data } = await api.get("/users");
  return UserSchema.array().parse(data);
};
```

## Never Do

```tsx
useEffect(() => { axios.get("/users"); }, []);
```
