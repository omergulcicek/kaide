---
description: "USE WHEN: Server state, query/mutation hook yazıyorsan."
globs: "src/features/**/api/*.{ts,tsx},src/features/**/hooks/*.{ts,tsx},src/providers/query-provider.tsx"
alwaysApply: false
---

# TanStack Query

## Constraints

- **Structure:** Query Key Factory kullan (`src/features/[feature]/api/query-keys.ts`).
- **Hooks:** Her query/mutation için custom hook yaz.
- **Keys:** `as const` kullan. Hiyerarşik yapı kur (all -> lists -> details).
- **Signal:** `AbortSignal`'i API fonksiyonuna ilet.
- **Invalidation:** Mutation `onSuccess`'inde ilgili key'leri invalidate et.
- **Pagination:** `page` ve filtreleri query key'e ekle.

## Bans

- Bileşen içinde `useQuery` (Custom hook zorunlu).
- Manuel string query key.
- API yanıtını validate etmeden kullanmak.
- Loading/Error state'lerini yoksaymak.

## Always Do

```ts
export const useGetPosts = () =>
  useQuery({ queryKey: postKeys.list(), queryFn: getPosts });
```

## Never Do

```tsx
useQuery({ queryKey: ["posts"], queryFn: () => axios.get("/posts") });
```
